{% extends 'store/layouts/base.html' %}
{% load static %}
{% block content %}
<div class="container mt-3">
    <form action="{% url 'placeorder' %}" method="post">
        {% csrf_token %}
    <div class="row">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h6>Basic Details</h6>
                    <hr/>
                    <div class="row checkoutform">
                        <div class="col-md-6">
                            <label>First Name :</label>
                            <input type="text" required name="fname" value="{{request.user.first_name}}" placeholder="Enter your first name" class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label>Last Name :</label>
                            <input type="text" required name="lname" value="{{request.user.last_name}}" placeholder="Enter your last name" class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label>E-mail :</label>
                            <input type="text" required name='email' value="{{request.user.email}}" placeholder="Enter your email" class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label>Mobile Number :</label>
                            <input type="phonenumber" required name="mobilenumber" value="{{ userprofile.mobilenumber }}" placeholder="Enter your mobile number" class="form-control" />
                        </div>
                        <div class="col-md-12">
                            <label>Address :</label>
                            <input type="text" required name="address" value="{{ userprofile.address }}" placeholder="Enter your B.No.,Street No." class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label>City Name :</label>
                            <input type="text" required name="city" value="{{ userprofile.city }}" placeholder="Enter your city name" class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label>State Name :</label>
                            <input type="text" required name="state" value="{{ userprofile.state }}" placeholder="Enter your state name" class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label>Country Name :</label>
                            <input type="text" required name="country" value="{{ userprofile.country }}" placeholder="Enter your country name" class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label>Enter Your Pincode :</label>
                            <input type="text" required name="pincode" value="{{ userprofile.pincode }}" placeholder="Enter your pincode" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow ">
                <div class="card-body">
                <h6 class="text-center">Order Summary</h6>
                <hr />
                {% if cartitems %}
                <table class="table table-striped table-bordered">
                    <thead>
                    <tr>
                    <th>Name </th>
                    <th>Quantity</th>
                    <th>Price</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for item in cartitems %}
                    <tr>
                    <td>
                        <img src="{{item.product.image.url}}" height="40px" width="40px">
                        {{item.product.name}}</td>
                    <td>{{item.quantity}}</td>
                    <td>{{item.product.price}}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                    <h6>Total Amount : {{total_price}}</h6>
                    <input type="hidden" value="COD" name="payment_mode">
                    <div class="mt-3">
                        <button type="submit" class="btn btn-success w-100">COD  & Place Order</button>
                        <div id="paypal-button-container"><button class="btn btn-primary">Pay Pal</button></div>
                    </div>
                {% else %}
                <h6>Your cart is empty</h6>
                {% endif %}
                </div>
            </div>
        </div>
    </div>
        </form>
</div>
{% endblock content %}
{% block scripts %}
<script src="https://www.paypal.com/sdk/js?client-id=AbI-6VstRcp63VtsgRY5HUdiK9T6wTUPr0EH84t7KU-z6zMZVObeuunMFARzRnPi-FtkIlq-Hw3ZB7bA&currency=USD"></script>
<script>
      paypal.Buttons({
        // Order is created on the server and the order id is returned
        createOrder: (data, actions) => {
          return fetch("/api/orders", {
            method: "post",
            // use the "body" param to optionally pass additional order information
            // like product skus and quantities
          })
          .then((response) => response.json())
          .then((order) => order.id);
        },
        // Finalize the transaction on the server after payer approval
        onApprove: (data, actions) => {
          return fetch(`/api/orders/${data.orderID}/capture`, {
            method: "post",
          })
          .then((response) => response.json())
          .then((orderData) => {
            // Successful capture! For dev/demo purposes:
            console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
            const transaction = orderData.purchase_units[0].payments.captures[0];
            alert(`Transaction ${transaction.status}: ${transaction.id}\n\nSee console for all available details`);
            // When ready to go live, remove the alert and show a success message within this page. For example:
            // const element = document.getElementById('paypal-button-container');
            // element.innerHTML = '<h3>Thank you for your payment!</h3>';
            // Or go to another URL:  actions.redirect('thank_you.html');
          });
        }
      }).render('#paypal-button-container');
    </script>
{% endblock scripts %}